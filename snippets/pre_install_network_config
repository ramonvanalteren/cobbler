# Start pre_install_network_config generated code
#if $getVar("system_name","") != ""
    #set ikeys = $interfaces.keys()
    #import re
    #set $vlanpattern = $re.compile("[a-zA-Z0-9]+\.[0-9]+")
    ##
    ## Determine if we should use the MAC address to configure the interfaces first
    ## Only physical interfaces are required to have a MAC address
    #set $configbymac = True
    #for $iname in $ikeys
        #set $idata = $interfaces[$iname]
        #if $idata["mac_address"] == "" and not $vlanpattern.match($iname):
            #set $configbymac = False
        #end if
    #end for
    #set $i = 0
    #set $hostname = ""

    #if $configbymac
        ## Output diagnostic message
# Start of code to match cobbler system interfaces to physical interfaces by their mac addresses
    #end if
    #for $iname in $ikeys
#  Start $iname
        #set $idata    = $interfaces[$iname]
        #set $mac      = $idata["mac_address"]
        #set $static   = $idata["static"]
        #set $ip       = $idata["ip_address"]
        #set $netmask  = $idata["subnet"]
        #set $gateway  = $idata["gateway"]
        #set $ihostname = $idata["hostname"]
        #set $devfile = "/etc/sysconfig/network-scripts/ifcfg-" + $iname
        #if $vlanpattern.match($iname)
            ## If this is a VLAN interface, skip it, anaconda doesn't know
            ## about VLANs.
            #set $is_vlan = "true"
        #else
            #set $is_vlan = "false"
        #end if
        #if $configbymac and $is_vlan == "false"
            ## This is a physical interface, hand it to anaconda.
            #if $static.lower() == "true" and $ip != ""
                #if $netmask == ""
                    ## Netmask not provided, default to /24.
                    #set $netmask = "255.255.255.0"
                #end if
                #set $netinfo = "--bootproto=static --ip=%s --netmask=%s" % ($ip, $netmask)
                #if $gateway != ""
                    #set $netinfo = "%s --gateway=%s" % ($netinfo, $gateway)
                #end if
            #else if $static.lower() == "false"
                #set $netinfo = "--bootproto=dhcp"
            #else
                ## Skip this interface, it's set as static, but without
                ## networking info.
#  Skipping (no configuration)...
                #continue
            #end if
            #if $ihostname != ""
                #set $netinfo = "%s --hostname=%s" % ($netinfo, $ihostname)
            #end if
# Configuring $iname ($mac)
if ifconfig | grep -i $mac
then
  IFNAME=\$(ifconfig | grep -i '$mac' | cut -d " " -f 1)
  echo "network --device=\$IFNAME $netinfo" >> /tmp/pre_install_network_config
fi
        #else
#  Skipping (not a physical interface)...
        #end if
    #end for
#end if
# Start pre_install_network_config generated code
