=head1 NAME

koan stands for "kickstart-over-a-network" and allows for both network provisioning of new virtualized guests (Xen, QEMU/KVM, VMware) and re-installation of an existing system.  koan is a client side application used with a Cobbler installation server.

=head1 SYNOPSIS

koan --server=<host> [--list-profiles|--list-systems]

koan --server=<host> [--virt|--replace-self|--display] [--profile=<name>|--system=<name>] [--add-reinstall-entry] [--virt-name=<name>] [--virt-path=<path>] [--virt-type=<type>] [--nogfx]

=head1 DESCRIPTION

When invoked, koan requests install information from a remote cobbler boot server.   What koan does with the cobbler data depends on whether it was invoked with --virt or --replace-self.

=head1 THE COBBLER SERVER

=over 

=item --server

Indicates the hostname of the Cobbler boot server to be contacted.  Successful
communication requires that no firewalls are blocking the cobbler XMLRPC port,
which is usually 25151, and that "cobblerd" and Apache is running on the cobbler server.

This argument must be specified for all koan commands.

Specifying "DISCOVER" for the server in all caps will request automatic discovery
of a nearby cobbler server using Avahi.  The avahi-tools package must be installed
to use this functionality.

=back

=head1 LISTING AVAILABLE RESOURCES

Lists of the resources that can be installed from a remote server can be obtained by using the following commands:

=over

=item --list-profiles

Shows a list of profiles that can be remotely installed from the cobbler server.

=item --list-systems

Shows a list of systems that can be remotely installed from the cobbler server.  Systems contain the same information as profiles but may be further customized in terms of parameters or kickstart information.  The level of customization varies depending on what has been specified on the cobbler server.

=back

Example:  koan --server=cobbler.example.org --list-systems

=head1 MAIN COMMANDS

The commands --virt, --replace-self, and --display all take the following arguments:

=over

=item --profile

Names a profile, known to cobbler, that is to be installed.

=item --system

Names a system, known to cobbler, that is to be installed.  --system cannot
be used at the same time as --profile; pick one or the other.

=back

=head1 VIEWING THE INSTALLATION DATA

Koan can provide some in depth data about profile and system records in Cobbler before installing
them.

Example:  koan --server=cobbler.example.org --display --profile=fedora9-xen-i386

=head1 VIRTUALIZED INSTALLS

When using --virt, koan will create new virtualized guests on a machine in accordance to the orders from cobbler.  These can be Xen, qemu/KVM, or VMware guests depending on --virt-type.  Once created, use "virsh" to control the guests.  Virsh may need a connection string like "virsh --connect qemu:///system".

Example:  koan --server=cobbler.example.org --virt --profile=fedora9-xen-i386

If --profile is specified, cobbler will default to naming domains based on their mac addresses; using --system will use the exact name given to the cobbler system object.  To install using an alternate descriptive name, specify one with --virtname.  

The additional parameters --virt-path, and --virt-type allow overriding certain defaults that are ordinarily defined by the remote cobbler server.

Optional advanced-configuration parameters for --virt:

=over

=item --virt-name

Specifies the name of the virtual machine/image to create.

=item --virt-path

Specifies the storage location for the virtual image, as a override of the default storage location that might be set on the cobbler server.  

To specify a file on the filesystem, this parameter must be an absolute path of an existing directory, with an optional filename component.  An example is "/opt/myimages".

To specify a partition, specify it with device file, such as "/dev/sda4".  You can also specify an empty LVM volume group with a syntax such as "VolGroup00" and koan will carve out space based on the name of the guest.

To specify multiple disks, seperate the values with commas, such as "/opt/foo/a,/opt/foo/b".  

=item --virt-type

Koan can install virtual guests for Xen, qemu/KVM, and VMware.   Usage of this parameter overrides the virt type that is specified in Cobbler, which may be set to "auto" or a specific preferred virtualization type that can vary based on the Cobbler profile or system record.

Valid types are "xenpv", "xenfv", "qemu" and "vmware".  "xenfv" and "vmware" types require PXE infrastructure.  For KVM, pick the virt type "qemu".  VMware support is experimental.  

=item --nogfx

This option prevents Xen based installs from establishing a VNC based display, so that the machine can accessed by xm/virsh consoles on the command line.  For qemu/KVM, VNC cannot be disabled as there is no text based console.

=head1 REINSTALLATION 

Installing virtual machines is only one feature of Koan, it can also be used to help in reinstalling running Linux systems.

When using '--replace-self', cobbler will install a new entry in the grub or lilo configuration of the system, so that the next time it reboots, it will immediately reinstall itself as defined to the specifications set by cobbler.  Specify a specific item from cobbler with --system or --profile, otherwise cobbler will try to see if there is a cobbler system record that matches a MAC address on the system.

This is useful to reinstall systems in conditions where ordinary PXE is not possible.  (Another alternative to this is the cobbler "buildiso" command).

After using this feature, reboot to initiate reinstallation.

Example:  koan --server=cobbler.example.org --profile=fedora7-xen-i386 --replace-self

Example:  koan --server=cobbler.example.org --replace-self

If you want to just add an entry to grub but not make it the default, add the additional argument "--add-reinstall-entry" to the command line.   Only one reinstall entry can be added to grub; re-running this command will replace the previous entry.

=head1 REINSTALLATION WITHOUT A COBBLER SERVER

While it is expected that nearly all users will want to use a cobbler server, the functionality of --replace-self can still be used in koan without contacting a cobbler server.  This may be useful if you want
to use koan with some existing infrastructure and can't yet upgrade that infrastructure to use cobbler.

Example:  koan --no-cobbler=http://somewebserver/ks.cfg --replace-self

Note that none of the other koan options work in this mode.

=head1 ADDITIONAL

Also see the cobbler manpage.  It is both entertaining and educational.

=head1 AUTHOR

Michael DeHaan <mdehaan@redhat.com>


